generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "mysql"
  url      = env("DATABASE_URL")
}

// === TABELAS EXISTENTES ===

model glicose {
  id           Int              @id @default(autoincrement())
  usuario_id   Int?
  valor_mgdl   Decimal?         @db.Decimal(5, 2)
  periodo      glicose_periodo?
  data_leitura DateTime?        @default(now()) @db.DateTime(0)
  usuarios     usuarios?        @relation(fields: [usuario_id], references: [id], onDelete: Cascade, onUpdate: NoAction, map: "glicose_ibfk_1")

  @@index([usuario_id], map: "usuario_id")
}

model hidratacao {
  id            Int       @id @default(autoincrement())
  usuario_id    Int?
  quantidade_ml Int?
  data_hora     DateTime? @default(now()) @db.DateTime(0)
  usuarios      usuarios? @relation(fields: [usuario_id], references: [id], onDelete: Cascade, onUpdate: NoAction, map: "hidratacao_ibfk_1")

  @@index([usuario_id], map: "usuario_id")
}

model medicamentos {
  id               Int       @id @default(autoincrement())
  usuario_id       Int?
  nome_remedio     String?
  dosagem          String?
  frequencia_horas Int?
  quantidade_total Int?
  horario_agendado DateTime?

  // ADICIONE ESTAS DUAS LINHAS PARA CONECTAR COM A TABELA USUARIOS
  usuarios         usuarios? @relation(fields: [usuario_id], references: [id], onDelete: Cascade, onUpdate: NoAction)

  @@index([usuario_id], map: "medicamentos_usuario_id_idx")
}

model recuperacao_senha {
  id         Int       @id @default(autoincrement())
  usuario_id Int?
  token      String    @db.VarChar(255)
  expira_em  DateTime  @db.DateTime(0)
  usuarios   usuarios? @relation(fields: [usuario_id], references: [id], onDelete: Cascade, onUpdate: NoAction, map: "recuperacao_senha_ibfk_1")

  @@index([usuario_id], map: "usuario_id")
}

model sinais_vitais {
  id          Int      @id @default(autoincrement())
  sistolica   Int
  diastolica  Int
  glicose     Int?
  data_hora   DateTime @default(now())
  usuario_id  Int
  usuarios    usuarios @relation(fields: [usuario_id], references: [id])
}

// === MODELO PRINCIPAL (USUARIOS) ===
model usuarios {
  id                Int                    @id @default(autoincrement())
  nome              String                 @db.VarChar(100)
  email             String                 @unique(map: "email")
  senha             String                 @db.VarChar(255)
  cpf               String                 @unique
  data_nascimento   String?
  tipo_usuario      usuarios_tipo_usuario? @default(idoso)
  criado_em         DateTime?              @default(now()) @db.Timestamp(0)

  // RELACIONAMENTOS (Onde as outras tabelas se conectam)
  glicose           glicose[]
  hidratacao        hidratacao[]
  medicamentos      medicamentos[]
  recuperacao_senha recuperacao_senha[]
  sinais_vitais     sinais_vitais[]

  // AQUI ESTAVA FALTANDO ESSA LINHA:
  consultas         consultas[]
  ficha_medica      ficha_medica?
}

// === NOVA TABELA DE AGENDA ===
model consultas {
  id            Int      @id @default(autoincrement())
  usuario_id    Int
  medico        String   @db.VarChar(100)
  especialidade String   @db.VarChar(100)
  data_hora     DateTime @db.DateTime(0)
  local         String?  @db.VarChar(200)

  // Relacionamento com o usuário
  usuarios      usuarios @relation(fields: [usuario_id], references: [id])
}

// === ENUMS ===
enum glicose_periodo {
  jejum
  pos_prandial
  antes_dormir
}

enum usuarios_tipo_usuario {
  idoso
  cuidador
}

model ficha_medica {
  id               Int      @id @default(autoincrement())
  usuario_id       Int      @unique // Um usuário só tem UMA ficha
  tipo_sanguineo   String?  @db.VarChar(10)  // Ex: O+
  alergias         String?  @db.VarChar(255) // Ex: Dipirona, Camarão
  doencas_cronicas String?  @db.VarChar(255) // Ex: Hipertensão
  contato_nome     String?  @db.VarChar(100) // Ex: Filho João
  contato_telefone String?  @db.VarChar(20)  // Ex: 11999999999
  usuarios         usuarios @relation(fields: [usuario_id], references: [id], onDelete: Cascade)
}